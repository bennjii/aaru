[package]
name = "routers_codec"
version = "0.1.0"
edition = "2024"
include = ["docs/**", "build.rs", "proto/**", "src/**", "benches/**"]
description = "Codec primitives for routers"
license = "MIT"
repository = "https://github.com/bennjii/routers"

[lib]
name = "routers_codec"
path = "./src/lib.rs"
bench = false

[dependencies]
# GeoRust
geo = "0.30.0"
rstar = { version = "0.12.2", features = ["serde"] }

either = "1.13.0"
rayon = "1.10.0"

prost = { version = "0.13.3" }
bytes = { version = "1.8.0", features = ["default"] } # Required for io::Cursor
flate2 = { version = "1.0.34", features = ["zlib-ng"] }

log = { version = "0.4.22", features = [] }
test-log = { version = "0.2.16", features = ["log"] }

mimalloc = { version = "0.1.43", optional = true }

tracing = { version = "0.1.40", optional = true }
tracing-subscriber = { version = "0.3.18", features = [
    "tracing-log",
    "fmt",
    "env-filter",
], optional = true }

[dev-dependencies]
fixtures = { workspace = true }

osmpbf = { version = "0.3.4", features = ["zlib-ng"], default-features = false }
criterion = { version = "2.10.1", features = [
    "async_tokio",
], package = "codspeed-criterion-compat" }

[build-dependencies]
prost-build = { version = "0.13.3" }

[[bench]]
name = "codec_sweep"
harness = false

[[bench]]
name = "codec_target"
harness = false

[profile.release]
opt-level = 3
lto = "fat"

[profile.bench]
opt-level = 3
lto = true

[features]
default = ["mimalloc"]
tracing = ["dep:tracing", "dep:tracing-subscriber"]